# JVM 이해하기
## 자바, JVM, JDK, 그리고 JRE
포함 관계
```
- JDK 
    - 개발 툴
        - appleviewer, apt, excheck, jar ....
    - JRE 
        - JVM
        - Library 
```

JVM
```
- 자바 가상 머신, 자바 바이트 코드(.class)를 OS에 특화된 코드로 변환하여 실행
- 바이트 코드를 실행하는 표준이자 구현체, JVM 자체는 표준이지만 벤더 마다 다르다.
- JVM 벤더: 오라클, 아마존 ...
- 특정 플랫폼에 종속적
```

JRE (Java Runtime Environment)
```
- 자바 애플리케이션을 실행할 수 있도록 구성된 배포판 
- JVM과 핵심 라이브러리 및 자바 런타임 환경에서 사용하는 프로퍼티 세팅이나 리소스 파일 가지고 있음
- 개발 관련 도구는 가지고 있지 않음 -> JDK가 가지고 있음
```

JDK (Java Development Kit)
```
- JRE + 개발에 필요한 툴
- 오라클은 자바 11부터는 JDK 만 제공하여 JRE는 제공 x
```


## JVM
구조
```
- 클래스 로더 시스템: 로딩, 링크, 초기화
    - 메모리 
        - 스택 
        - PC  
        - 힙 
        - 메소드
        - 네이티브 메소드 스택
            - 실행 엔진: 인터프리터, JIT 컴파일러, GC
            - 네이티브 메소드 인터페이스
            - 네이티브 메소드 라이브러리
```

메모리
```
- 클래스 수준의 정보(클래스 이름, 부모 클래스 이름, 메소드, 변수) 저장, 공유 자원
- 힙 영역: 인스턴스(객체)를 저장 및 공유
- 스택 영역에는 쓰레드 마다 런타임 스택을 만듬
    - 그 안에 메소드 호출을 스택  프레임이라 부르는 블럭으로 쌓음
    - 쓰레드가 종료되면 런타임 스택도 사라짐
- PC(ProgramCounter) 레지스터
    - 쓰레드 마다 쓰레드 내 현재 실행할 스택 프레임을 가리키는 포인터 생성
- 네이티브 메소드 스택은 네이티브 메소드를 호출할 때 생기는 별도의 스택 영역 
    - 메서드에 Native 가 붙어있고 구현을 C나 C++로 한 메서드, ex) Thread.currentThread();
- 네이티브 메서드를 사용하는 코드가 있다면 네이티브 메소드 스택이 생기고 그 안에 네이티브 메소드 인터페이스를 호출하는 스택 프레임이 하나 쌓일 것이다.

# 추가
- 스택, PC(Program Counter), 네이티브 메소드 스택은 스레드에서만 공유하는 자원임     
```

JIT(Just in time) 컴파일러
```
- 바이트코드를 네이티브 코드로 컴파일 해줌 
```


GC
```
- Throw put을 줄이는
- Stop the World를 줄이는 
    - 많은 객체를 생성하고 Response 타임이 중요한 경우 사용, pause 현상을 최소화 해야함
```

요약
```
- 클래스 로더가 읽음
- 그것을 메모리에 적절하게 배치
    - 실행할 때 스레드가 생성되면 스레드에 맞게 스택, PC, 네이티브 멧드 스택이 생성 
- 실행 엔진이 바이트코드를 한 줄씩 실행 -> 스택 사용
- 한 줄 한 줄 읽는 것은 비효율적이니 JIT 컴파일러 사용
- 메모리 최적화를 위해 GC를 사용 
- 만약 실행 엔진이 네이티브 엔진(코어쪽은 주로 네이티브 ... )을 사용 한다면 JNI(네이티브 메소드 인터페이스)를 통해서 네이티브 메소드 라이브러리 사용  
```



## 클래스 로더
- 로딩 -> 링크 -> 초기화
- FQCN (Full Qualify Class Name): 패키지 경로까지 포함

- 클래스 타입의 객체가 로딩을 하면 힙 영역에 만들어짐
    - 힙, 메소 드 영역은 모든 쓰레드에서 공용으로 사용


- Resolve(Optional)
    - 나중에 실제 레퍼런스를 사용할 때 발생할 수 있다.
    - 심볼릭 메모리 메퍼런스 (논리적인 참조, 실제 레퍼런스를 가리키지는 않음)
    - 실제 힙에 있는 객체를 가리키게 함